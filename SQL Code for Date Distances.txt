WITH RECURSIVE month_sequence AS (
    -- Start from 2015-01
    SELECT TO_DATE('2015-01-01', 'YYYY-MM-DD') AS month_start
    UNION ALL
    -- Recursively generate the next month
    SELECT DATEADD(MONTH, 1, month_start)
    FROM month_sequence
    WHERE month_start <= '2024-08-01'  -- Stop at the end date (2024-08)
),
total_months AS (
    -- Calculate the total number of months between 2015-01 and 2024-08
    SELECT DATEDIFF(MONTH, TO_DATE('2015-01-01', 'YYYY-MM-DD'), TO_DATE('2024-08-01', 'YYYY-MM-DD')) AS total_months
),
term_grouped AS (
    -- Assign each row to a random term group based on the total number of months divided into 5 groups
    SELECT 
        month_start,
        DATEADD(MONTH, 1, month_start) AS month_end,  -- Calculate the next month for month_end
        DATEDIFF(MONTH, TO_DATE('2015-01-01', 'YYYY-MM-DD'), month_start) AS month_diff,
        total_months,
        -- Calculate the term group based on month_diff, dividing the total months into 5 equal segments
        CASE
            WHEN month_diff < (total_months / 5) THEN 'Group 1'
            WHEN month_diff < (total_months / 5) * 2 THEN 'Group 2'
            WHEN month_diff < (total_months / 5) * 3 THEN 'Group 3'
            WHEN month_diff < (total_months / 5) * 4 THEN 'Group 4'
            ELSE 'Group 5'
        END AS term_group
    FROM month_sequence, total_months
)
SELECT 
    TO_CHAR(month_start, 'YYYY-MM') AS month_start,  -- Format the month_start as 'YYYY-MM'
    TO_CHAR(month_end, 'YYYY-MM') AS month_end,      -- Format the month_end as 'YYYY-MM'
    month_diff,                                      -- Show the calculated month_diff
    term_group                                        -- Show the term group
FROM term_grouped
ORDER BY month_start;  -- Ensure the results are ordered by the starting month
